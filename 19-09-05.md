# 실시간 데이터 처리 [ 2019-09-05 ]

### 공부 이유 : 
-------------------------

빅데이터를 처리하는 프레임워크인 Hadoop MapReduce는 대량 데이터를 분산 처리할 수 있는 좋은 기법이지만,
배치 방식으로 데이터를 처리하기 떄문에 실시간으로 데이터를 조회하기 어렵다.<br>
빅데이터 실시간으로 처리하는 기법이 무엇이 있을까? 기술 블러그를 통해서 공부를 해보았지만,<br>
아직 모르는 용어나 개념들이 많아서 데이터를 실시간으로 처리하기 위한 개념과 용어들을 공부해보았습니다. 



### 공부 내용 :
-------------------------

최근 다양한 곳에서 실시간 분산 쿼리나 스트리밍 처리 기법이 많이 연구되고 있다.<br>

실시간 분산 쿼리 : [클러스터][1]를 구성하는 노드가 각자 쿼리를 처리하게 해 한 번에 처리할 데이터의 크기는 작게 하면서 
이를 병렬 처리해 응답 시간을 실시간 수준으로 높이는 방식이다.

스트리밍 처리 : 끊임없이 들어오는 데이터를 유입 시점에 분석해 원하는 데이터 뷰로 미리 만드는 방식이다.

#### 분산 쿼리의 기본 동작 방식 : 파티셔닝과 셔플
[파티셔닝][2] : 데이터를 여러 클러스터 노드로 분할하는 메키너즘을 의미한다.<br>
즉, 파티셔닝은 특정 키를 기준으로 이 테이블을 여러 노드로 분할해 저장하는 방식이다.<br>
셔플 : 파티션 키가 아닌 다른 키로 조인해야 한다면, 데이터를 조인 키 단위로 모으는 재분할(re-partitioning) 과정


##### DB 파티셔닝의 분할 기준
데이터베이스 관리 시스템은 분할에 대한 각종 기준을 제공하고 있다. 분할은 '분할 키(partitioning key)'를 사용한다.

##### 1. 범위 분할 (range partitioning) 
 - 분할 키 값이 범위 내에 있는지 여부로 구분한다.

##### 2. 목록 분할 (list partitioning) 
 - 값 목록에 파티션을 할당 분할 키 값을 그 목록에 비추어 파티션을 선택한다.

##### 3. 해시 분할 (hash partitioning) 
 - 해시 함수의 값에 따라 파티션에 포함할지 여부를 결정한다.
 
##### 4. 합성 분할 (listitioning) 
 - 상기 기술을 결합하는 것을 의미하며, 예를 들면 먼저 범위 분할하고, 다음에 해시 분할 같은 것을 생각할 수 있다.
 


#### 스트리밍 데이터 처리를 이해하기 위한 몇몇 용어와 개념

##### Bounded data 와 Unbounded data
먼저 스트리밍 데이터 처리를 이해하려면 데이터의 종류에 대해서 먼저 알아야된다.
 - Bounded data : 데이터가 딱 저장되고 더 이상 증가나 변경이 없는 형태로 계속 유지되는 데이터를 뜻한다.
 - Unbounded data : 데이터의 수가 정해져 있지 않고 계속해서 추가되는, 즉 끊임 없이 흘러 들어오는 데이터라고 볼 수 있다.
 
데이터의 발생 시간과 시스템에서 처리되는 시간이 차이가 있는데, 이를 각각 <strong>Event time</strong>과 <strong>Processing time</strong>이라고 한다.<br>
사용자가 이벤트를 발생한 시간이 1:00:00 이라고 했을 때 이벤트가 발생한 데이터가 네트워크를 타고 서버로 도달하여 프로그램 로직을 수행하고 저장하는데 
소요된 시간을 2초라고 가정하면, <strong>Event time</strong> 은 1:00:00 이고, <string>Processing time</strong>은 1:00:02 가 된다.

##### UnBounded data 처리
복잡한 것은 스트리밍 데이터 즉, Unbounded data를 처리하는 방법이다. 처리 방식은 배치와 스트리밍 두 가지 방식으로 처리할 수 있다.
배치 처리 방식은 일정 시간 마다 데이터를 처리한다고 생각하면 된다. ( 이 방식은 실시간성이 떨어진다.)

스트리밍 처리 방법에는 크게 4가지 방식이 있다.

1. Time agnostic
  - 데이터가 시간 속성을 가지고 있지 않는 데이터이다. 들어오는 데로 처리를 하면 되기 떄문에 다른 노하우가 필요 없지만, 하나의 데이터 형이기 때문에 간단하게 언급만 한다.

2. Filtering
  - 다음으로 많이 사용 되는 것이 필터링인데, 들어오는 데이터 중 특정 데이터만 필터링 해서 저장 하는 구조이다.
  
3. Inner joins (교집합)
  - 두 개의 Unbounded 데이터에서 들어오는 값을 서로 비교하여 매칭 시켜서 값을 구하는 방식

4. Approximation algorithm (근사치 추정)
  - 실시간 데이터 분석에서 많이 사용되는데, 실시간 분석에서는 전체 데이터를 모두 분석할 수 있는 시간이 없는 경우가 많고, <br>
 시급한 분석이 필요한 경우가 있기 때문에, 전체 데이터를 분석하지 않고 일부만 분석하거나 또는 대략적인 데이터의 근사값만을 구하는 방법으로 해서,<br>
 빠르게 데이터를 분석하는 경우가 있다. 이런한 방식이 근사치 추정 방식이다.

5. Windoing
  - 실시간 스트리밍 데이터 처리에서 중요한 개념 중 하나로써, 일정 시간 간격으로 처리하는 것을 정의한다.

##### 시간대별 Window 처리 방식

######1. Processing time bases windowing
Processing time을 기준으로 데이터를 처리하는 것은 크게 어렵지 않다. 데이터가 도착한 순서대로 처리해서 저장하면 된다.

######2. Event time bases windowing
데이터가 들어오는 것이 순서대로 들어오지 않는 경우가 많고, 또한 데이터의 도착 시간 또한 일정하지 않다.



### 마치며
----------------------------
실시간 데이터 분석에 사용되는 개념과 용어들에 대해서 공부해 보았습니다.
아직 데이터 분석 처리 관해서 걸음마 단계다 보니.. 블러그나 기술 문서를 읽어도 이해가 안되는 부분이 많았던거 같습니다.
데이터 실시간 처리가 중요해지고 있고 이 기술을 빅데이터 적용하면 많은 비용과 시간을 줄일 수 있을 것이라고 생각한다.






[1]:https://3dmpengines.tistory.com/1914 "여러 대의 컴퓨터를 네트워크를 통해 연결하여 하나의 단일 컴퓨터처럼 동작하도록 제작한 컴퓨터를 말한다."
[2]:https://gmlwjd9405.github.io/2018/09/24/db-partitioning.html
